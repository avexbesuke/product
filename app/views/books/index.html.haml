%html.default
  .body-book-index
    .book-index-wrapper
      .book-index-wrapper__menu
        -if @books["items"] != nil
          - @books["items"].each do |book|
            .book-index-wrapper__menu__book
              = form_with url:emotion_write_path,method: :post,local: true do |f|
                .book-index-wrapper__menu__book__image
                  -if book["volumeInfo"]["imageLinks"] != nil
                    = image_tag(book["volumeInfo"]["imageLinks"]["thumbnail"],size:"128x181")
                    = link_to reads_path(title:book["volumeInfo"]["title"],author:book["volumeInfo"]["authors"] ,image_url:book["volumeInfo"]["imageLinks"]["thumbnail"],synopsis:book["volumeInfo"]["description"]), method: :post,class: "book__image__link", remote: true do
                      -if user_signed_in?
                        -if Book.find_by(title: book["volumeInfo"]["title"]) != nil
                          - if Book.find_by(title: book["volumeInfo"]["title"]).reads.where(user_id: current_user.id).exists?
                            = fa_icon 'book',class: 'read-btn read-btn-on'
                          -else
                            = fa_icon 'book',class: 'read-btn read-btn-off'
                        -else
                          = fa_icon 'book',class: 'read-btn read-btn-off'
                  -else
                    = image_tag("noimage.png", size:"128x181")
                    = link_to reads_path(title:book["volumeInfo"]["title"],author:book["volumeInfo"]["authors"],image_url:"noimage.png",synopsis:book["volumeInfo"]["description"]), method: :post,class: "book__image__link", remote: true do
                      -if user_signed_in?
                        -if Book.find_by(title: book["volumeInfo"]["title"]) != nil
                          - if Book.find_by(title: book["volumeInfo"]["title"]).reads.where(user_id: current_user.id).exists?
                            = fa_icon 'book',class: 'read-btn read-btn-on'
                          -else
                            = fa_icon 'book',class: 'read-btn read-btn-off'
                        -else
                          = fa_icon 'book',class: 'read-btn read-btn-off'
                .book-index-wrapper__menu__book__title
                  = book["volumeInfo"]["title"]
                .book-index-wrapper__menu__book__authors
                  -if book["volumeInfo"]["authors"] != nil
                    = book["volumeInfo"]["authors"]
                  -else
                    = "[作者情報なし]" 
                -if book["volumeInfo"]["imageLinks"] != nil
                  = f.hidden_field :image_url, value: book["volumeInfo"]["imageLinks"]["thumbnail"]
                -else
                  = f.hidden_field :image_url, value:"noimage.png"
                = f.hidden_field :title, value: book["volumeInfo"]["title"]
                = f.hidden_field :author, value: book["volumeInfo"]["authors"]
                = f.hidden_field :synopsis, value: book["volumeInfo"]["description"]
                - if user_signed_in?
                  .book-index-wrapper__menu__book__submit
                    - if current_user.books.where(title: book["volumeInfo"]["title"]).length == 0
                      = f.submit 'マイベストにする!',class: 'best-btn'
                    - else
                      .best-btn-after
                        = "マイベスト！"
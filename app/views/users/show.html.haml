%html.default
  %body
    .mybest-book-wrapper
      %h2 
        = "”#{@user.username}”のマイベストブック！"
      .mybest-book-wrapper__list
        - @user_emotions.each do |emotion|
          .mybest-book-wrapper__list__view
            .mybest-book-wrapper__list__view__data
              .mybest-book-wrapper__list__view__image
                = link_to(image_tag(emotion.book.image_url, size: "226x316"),book_path(emotion.book.id))
            .mybest-book-wrapper__list__view__emotion
              - if emotion.tag_list.length != 0
                = render 'emotions/tag_list', tag_list: emotion.tag_list
              .lead
                .title
                  = emotion.book.title
                .edit
                  = link_to edit_emotion_path(emotion.id) do
                    = fa_icon "edit"
                .delete
                  = link_to emotion_path(emotion.id),method: :delete do
                    = fa_icon "trash"
              .label
                = "好きな理由:"
              .body  
                = simple_format(emotion.body)
                
          -  other_user = emotion.book.users.where.not(id: current_user.id ).order("RAND()").limit(1000).pluck(:id)
          -  other_emotion = Emotion.where(user_id: other_user).where.not(book_id: emotion.book.id).pluck(:book_id)
          -  @other_books = Book.where(id: other_emotion).order("RAND()").limit(5)
          - if @other_books.length != 0
            .mybest-book-wrapper__list__heading
              = "”#{emotion.book.title}” を ”好きな人が好きな本”"
            .mybest-book-wrapper__list__view-other    
              - @other_books.sample(5).each do |book|
                .mybest-book-wrapper__list__view-other__list
                  .mybest-book-wrapper__list__view-other__list__image
                    = link_to(image_tag(book.image_url,size: "128x192"), book_path(book.id))
                  .mybest-book-wrapper__list__view-other__list__title
                    = book.title
          - else
            .yohaku

    = paginate @user_emotions